{% extends 'base.html' %}
{% load static %}

{% block title %}Area Products | Lighting ERP{% endblock %}
{% block header_title %}Area Products{% endblock %}

{% block header_controls %}
<div style="display: flex; gap: 10px; align-items: center;">
    <a href="configurations/add/" class="btn btn-primary">
        <i class="fa-solid fa-plus"></i> Add Configuration
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Area Header with Stats -->
    <div class="card"
        style="margin-bottom: 2rem; background: linear-gradient(135deg, var(--bg-card), hsla(280, 85%, 20%, 0.2)); position: relative; overflow: hidden;">
        <div
            style="position: absolute; top: -50%; right: -20%; width: 400px; height: 400px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); opacity: 0.2; pointer-events: none;">
        </div>

        <div style="position: relative; z-index: 1;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                <div>
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <div
                            style="width: 48px; height: 48px; border-radius: var(--radius-md); background: linear-gradient(135deg, var(--accent), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 1.25rem; color: white;">
                            <i class="fa-solid fa-layer-group"></i>
                        </div>
                        <div>
                            <h3 id="area-name-display"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--text-main); margin-bottom: 0.25rem;">
                                Loading Area...
                            </h3>
                            <span id="area-code-display" class="role-badge badge-viewer"
                                style="font-size: 0.75rem;">-</span>
                        </div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div
                        style="font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 0.25rem;">
                        Total Area Cost
                    </div>
                    <div id="area-total-cost"
                        style="font-size: 2rem; font-weight: 700; color: var(--accent); font-family: monospace;">
                        â‚¹ 0.00
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--card-border);">
                <div>
                    <div
                        style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.25rem;">
                        Configurations</div>
                    <div id="area-product-count"
                        style="font-size: 1.5rem; font-weight: 700; color: var(--primary-light);">0</div>
                </div>
                <div>
                    <div
                        style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.25rem;">
                        Drivers</div>
                    <div id="area-driver-count" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">0
                    </div>
                </div>
                <div>
                    <div
                        style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.25rem;">
                        Accessories</div>
                    <div id="area-accessory-count" style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">0
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Header -->
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
        <h4 style="font-size: 1.25rem; font-weight: 600;">
            <i class="fa-solid fa-layer-group" style="color: var(--accent); margin-right: 0.5rem;"></i>
            Configurations
        </h4>
        <div style="color: var(--text-muted); font-size: 0.85rem;">
            <i class="fa-solid fa-info-circle"></i>
            Manage products, drivers, and accessories via configurations
        </div>
    </div>

    <!-- Product List Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 25%;">Product Configuration</th>
                    <th style="width: 15%;">Driver</th>
                    <th style="width: 20%;">Accessories</th>
                    <th style="width: 10%; text-align: center;">Qty</th>
                    <th style="width: 10%; text-align: right;">Unit Rate</th>
                    <th style="width: 10%; text-align: right;">Total</th>
                    <th style="width: 5%;">Actions</th>
                </tr>
            </thead>
            <tbody id="product-list">
                <tr>
                    <td colspan="8" style="text-align: center; padding: 3rem;">
                        <i class="fa-solid fa-spinner fa-spin"
                           style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                        <p style="color: var(--text-secondary);">Loading configurations...</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<style>
    /* Product Table Enhancements */
    .table-container table tbody tr:hover {
        background: var(--bg-hover);
    }

    .product-row {
        transition: all var(--transition-base);
    }

    .product-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
    }

    .product-name-cell {
        font-weight: 600;
        color: var(--text-main);
    }

    .product-description {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }

    .product-code-badge {
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: 'Courier New', monospace;
        background: var(--bg-hover);
        padding: 0.125rem 0.5rem;
        border-radius: var(--radius-sm);
        display: inline-block;
    }

    /* Form Styles */
    .selection-box {
        border: 1px dashed var(--card-border);
        border-radius: var(--radius-md);
        padding: 1rem;
        background: hsla(220, 25%, 18%, 0.3);
        margin-top: 0.5rem;
        text-align: center;
    }
    
    .item-card-mini {
        background: var(--bg-card);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-sm);
        padding: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }

    .empty-state i {
        font-size: 4rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
        opacity: 0.3;
    }

    .empty-state h4 {
        font-size: 1.25rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }

    .form-section {
        background: hsla(220, 25%, 15%, 0.3);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-bottom: 2rem;
        position: relative;
    }

    .section-title {
        color: var(--text-main);
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-badge {
        position: absolute;
        top: -10px;
        left: 1rem;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge-primary { background: var(--primary); color: white; }
    .badge-success { background: var(--success); color: white; }
    .badge-warning { background: var(--warning); color: black; }

    .accessory-row {
        display: grid;
        grid-template-columns: 1fr 80px 40px;
        gap: 0.75rem;
        align-items: end;
        padding: 0.75rem;
        background: hsla(220, 25%, 20%, 0.4);
        border-radius: var(--radius-md);
        margin-bottom: 0.5rem;
        border: 1px solid var(--card-border);
    }
</style>

<!-- MODALS -->

<!-- 1. Add/Edit Configuration Drawer -->
<div class="drawer" id="drawer-product-form" data-overlay="overlay-product-form" style="width: 550px;">
    <div class="drawer-header">
        <h3 id="product-modal-title">Add Configuration</h3>
        <button class="btn-icon" onclick="Modals.close('drawer-product-form')">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>
    <div class="drawer-content">
        <form id="form-product">
            <input type="hidden" id="config-id">
            
            <!-- Section 1: Product -->
            <div class="form-section">
                <div class="section-badge badge-primary">Section 1</div>
                <h5 class="section-title">
                    <i class="fa-solid fa-lightbulb"></i> Product (Mandatory)
                </h5>
                
                <div class="form-group">
                    <label>Select Product <span style="color: var(--error);">*</span></label>
                    <select id="select-product" class="form-control select2" required>
                        <option value="">-- Choose a Product --</option>
                    </select>
                </div>

                <div class="form-group" style="margin-top: 1rem;">
                    <label>Product Quantity <span style="color: var(--error);">*</span></label>
                    <input type="number" id="prod-qty" class="form-control" min="1" value="1" required>
                </div>
            </div>

            <!-- Section 2: Driver -->
            <div class="form-section">
                <div class="section-badge badge-success">Section 2</div>
                <h5 class="section-title">
                    <i class="fa-solid fa-microchip"></i> Driver (Optional)
                </h5>
                <input type="hidden" id="config-driver-record-id">

                <div class="form-group">
                    <label>Select Driver</label>
                    <select id="select-driver" class="form-control">
                        <option value="">-- No Driver --</option>
                    </select>
                </div>

                <div class="form-group" style="margin-top: 1rem;">
                    <label>Driver Quantity</label>
                    <input type="number" id="driver-qty" class="form-control" min="1" value="1" disabled>
                    <small style="color: var(--text-muted);">Enabled only if a driver is selected</small>
                </div>
            </div>

            <!-- Section 3: Accessories -->
            <div class="form-section">
                <div class="section-badge badge-warning">Section 3</div>
                <h5 class="section-title">
                    <i class="fa-solid fa-cogs"></i> Accessories (Optional)
                </h5>
                
                <div id="accessories-container">
                    <!-- Accessory rows will be added here -->
                </div>

                <button type="button" class="btn btn-outline-warning btn-sm" style="margin-top: 1rem; width: 100%; border-style: dashed;" onclick="AreaProductsPage.addAccessoryRow()">
                    <i class="fa-solid fa-plus"></i> Add Accessory Row
                </button>
            </div>
        </form>
    </div>
    <div class="drawer-footer">
        <button class="btn btn-secondary" onclick="Modals.close('drawer-product-form')">Cancel</button>
        <button type="submit" form="form-product" class="btn btn-primary">
            <i class="fa-solid fa-save"></i> Save Configuration
        </button>
    </div>
</div>
<div class="drawer-overlay" id="overlay-product-form"></div>

{% endblock %}



{% block scripts %}
<script src="{% static 'js/area_products.js' %}"></script>
{% endblock %}